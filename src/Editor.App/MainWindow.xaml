<Window x:Class="Editor.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Freemium Photo Editor"
        Width="600" Height="400"
        Background="{DynamicResource Brush.AppBackground}"
        UseLayoutRounding="True"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="False">

  <!-- WindowChrome tal cual lo tenías -->
  <WindowChrome.WindowChrome>
    <WindowChrome
        CaptionHeight="48"
        ResizeBorderThickness="10"
        GlassFrameThickness="0"
        CornerRadius="0"
        UseAeroCaptionButtons="True" />
  </WindowChrome.WindowChrome>

  <!-- === Recursos === -->
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
  </Window.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="48"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Top bar personalizada con look tipo Windows Photos -->
    <Border Grid.Row="0"
            Style="{DynamicResource TopBarBorder}"
            MouseLeftButtonDown="TopBar_MouseLeftButtonDown">
      <Grid x:Name="TitleBar" Height="32" Background="Transparent">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Izquierda: acciones principales -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">

          <!-- Open: siempre visible -->
          <Button x:Name="OpenBtn"
                  WindowChrome.IsHitTestVisibleInChrome="True"
                  Style="{DynamicResource AccentCommandButtonStyle}"
                  Click="Open_Click"
                  ToolTipService.ToolTip="Open image"
                  Margin="0,0,8,0"
                  Width="80"
                  Height="30">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
              <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8E5;" Margin="0,0,6,0"
                         Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
              <TextBlock Text="Open" FontWeight="SemiBold"
                         Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
            </StackPanel>
          </Button>

          <!-- Edit: sólo si hay imagen -->
          <Button x:Name="EditBtn"
                  WindowChrome.IsHitTestVisibleInChrome="True"
                  Style="{DynamicResource AccentCommandButtonStyle}"
                  Click="Edit_Click"
                  ToolTipService.ToolTip="Edit image"
                  Margin="0,0,8,0"
                  Width="80"
                  Height="30"
                  Visibility="Collapsed"> <!-- arranca oculto -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
              <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE70F;" Margin="0,0,6,0"
                        Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
              <TextBlock Text="Edit" FontWeight="SemiBold"
                        Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
            </StackPanel>
          </Button>

          <!-- Separador opcional -->
          <Separator Width="1" Margin="0,0,8,0" />

          <!-- Undo/Redo: ocultos si no hay imagen; habilitados según historial -->
          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  x:Name="UndoBtn"
                  Style="{DynamicResource TopBarIconButtonStyle}"
                  Click="Undo_Click"
                  ToolTipService.ToolTip="Undo"
                  Margin="0,0,4,0"
                  Visibility="{Binding HasImage, Converter={StaticResource BoolToVis}}"
                  IsEnabled="{Binding CanUndo}">
            <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE7A6;"/>
          </Button>

          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  x:Name="RedoBtn"
                  Style="{DynamicResource TopBarIconButtonStyle}"
                  Click="Redo_Click"
                  ToolTipService.ToolTip="Redo"
                  Visibility="{Binding HasImage, Converter={StaticResource BoolToVis}}"
                  IsEnabled="{Binding CanRedo}">
            <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE7A7;"/>
          </Button>
        </StackPanel>

        <!-- Centro: título del documento -->
        <TextBlock WindowChrome.IsHitTestVisibleInChrome="True"
                   x:Name="DocumentTitle"
                   Grid.Column="1"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   FontSize="14"
                   FontWeight="SemiBold"
                   Text="Freemium Photo Editor"
                   Opacity="0.92"/>

        <!-- Derecha: tema + controles de ventana -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,4,0">
          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  Style="{DynamicResource TopBarIconButtonStyle}"
                  Click="OnToggleThemeClick"
                  ToolTipService.ToolTip="Toggle light/dark"
                  Margin="0,0,4,0">
            <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE793;"/>
          </Button>
          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  Style="{DynamicResource WindowControlButtonStyle}"
                  Click="Minimize_Click"
                  ToolTipService.ToolTip="Minimize"
                  Content="&#xE921;"
                  Margin="0,0,2,0"/>
          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  x:Name="MaximizeRestoreBtn"
                  Style="{DynamicResource WindowControlButtonStyle}"
                  Click="MaximizeRestore_Click"
                  ToolTipService.ToolTip="Maximize"
                  Content="&#xE922;"
                  Margin="0,0,2,0"/>
          <Button WindowChrome.IsHitTestVisibleInChrome="True"
                  Style="{DynamicResource WindowCloseButtonStyle}"
                  Click="Close_Click"
                  ToolTipService.ToolTip="Close"
                  Content="&#xE8BB;"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Contenido -->
    <Grid Grid.Row="1" Background="{DynamicResource Brush.AppBackground}">
      <Image x:Name="Preview" Stretch="Uniform"
             HorizontalAlignment="Center" VerticalAlignment="Center"/>
    </Grid>
  </Grid>
</Window>
